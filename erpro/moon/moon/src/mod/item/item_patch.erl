-module(item_patch).
-export([
        send/1
    ]
).

-include("common.hrl").

send(Num) ->
    Data = data(Num), 
    send_mail(Data).

send_mail([]) ->
    ?INFO("物品补偿邮件发送完毕"),
    ok;
send_mail([{Rid,SrvId, ItemList} | T]) ->
    case do_send_mail(Rid, SrvId, ItemList) of
        ok ->
            send_mail(T);
        false ->
            ?ERR("Rid:~w发送邮件失败",[Rid]),
            send_mail(T)
    end.

do_send_mail(Rid, SrvId, ItemList) ->
    case mail:send_system({Rid, SrvId},
            {?L(<<"系统邮件">>), ?L(<<"亲爱的玩家您好,因为昨天更新问题导致道具丢失的物品已经帮你找回,敬请谅解,请您查收邮件,祝您游戏愉快">>), [], ItemList}) of
        ok -> ok;
        {false, _R} ->
            ?ERR("物品补偿发送邮件失败,原因:~s",[_R]),
            false
    end.

%% 4服数据
data(4) ->
    [
        {33, <<"4399_4">>, [{item,2,4238,30138,20,1,0,0,2,0,-1,0,2,0,10,1333667711,-1,[],45,1,[],[],[],0, []}, {item,2,4239,30139,20,1,0,0,2,0,-1,0,2,0,11,1333498920,-1,[],50,1,[],[],[],0, []}]},
        {122505, <<"4399_4">>, [{item,2,17099,25003,18,0,0,0,2,0,-1,0,17,0,12,1336299001,-1,[],1,9,[],[],[], 0,[]}, {item,2,17095,10928,11,3,0,0,1,0,0,0,1,0,8,1336299175,1600, [{21,100,86},{15,100,490},{5,0,0},{6,0,0},{7,0,0}], 50,3,[],[],[],0,[]}, {item,2,17094,10773,3,3,1,0,1,1,0,0,1,0,7,1336458234,1420, [{22,100,1}, {20,100,52}, {19,100,42}, {17,100,30}, {5,0,0}, {6,0,0}, {7,0,0}, {24,1050,5}, {18,7050,52}], 50,3,[], [{22,100,122},{19,100,210},{20,100,262}], [],0,[]}]},
        {19105, <<"4399_4">>, [{item,2,11,10909,13,3,1,0,2,0,5,0,1,0,11,1335755292,595, [{24,100,20}, {18,100,126}, {5,0,0}, {6,0,0}, {7,0,0}, {14,6055,30}, {29,9055,86}], 55,9,[],[],[],0,[]}, {item,2,7,10874,9,3,1,0,2,0,5,0,1,0,7,1335753479,846, [{15,100,712}, {21,100,126}, {5,0,0}, {6,0,0}, {7,0,0}, {21,5050,35}, {25,1050,2}, {25,6050,7}], 50,3,[],[],[],0,[]}, {item,2,4,10799,7,3,1,0,2,0,5,0,1,0,4,1335591284,416, [{15,100,624}, {21,100,110}, {5,0,0}, {6,0,0}, {7,0,0}, {21,6050,37}, {14,6050,36}], 50,3,[],[],[],0,[]}, {item,2,3,10899,8,3,1,0,2,0,5,0,1,0,3,1335515750,586, [{15,100,756}, {21,100,134}, {5,0,0}, {6,0,0}, {7,0,0}, {16,3050,186}, {60,5050,10}, {25,10050,11}], 50,3,[],[],[],0,[]}, {item,2,6,10849,10,3,1,0,2,0,5,0,1,0,6,1335515744,326, [{15,100,801}, {21,100,140}, {5,0,0}, {6,0,0}, {7,0,0}, {16,2050,123}, {62,7050,14}, {23,2050,4}], 50,3,[],[],[],0,[]}, {item,2,5,10824,6,3,1,0,2,0,5,0,1,0,5,1335540426,746, [{15,100,668}, {21,100,118}, {5,0,0}, {6,0,0}, {7,0,0}, {14,6050,54}, {15,3050,116}], 50,3,[],[],[],0,[]}, {item,2,2,10929,11,3,1,0,2,0,5,0,1,0,2,1335782833,1376, [{15,100,891}, {21,100,156}, {5,0,0}, {6,0,0}, {7,0,0}, {16,5050,383}, {25,6050,8}], 50,3,[],[],[],0,[]}, {item,2,93403,24100,19,1,0,0,1,0,-1,0,1,0,24,1334052356,-1,[],1,9,[],[],[],0, []}, {item,2,93386,33010,0,0,0,0,1,0,-1,0,1,0,7,1334634687,-1,[],1,9,[],[],[],0, []}]},
        {126131, <<"4399_4">>, [{item,2,9826,33028,0,0,0,0,2,0,-1,0,4,0,10,1335851686,-1,[],1,9,[],[],[],0, []}]}, 
        {113211, <<"4399_4">>, [{item,2,238916,10909,13,3,0,0,2,0,0,0,1,0,15,1336541571,810, [{18,100,79},{24,100,20},{5,0,0},{6,0,0},{7,0,0}], 55,9,[],[],[],0,[]}]},
        {10161, <<"4399_4">>, [{item,2,3306,30210,20,0,0,0,3,0,-1,0,1,0,17,1336301020,-1,[],1,9,[],[],[],0, []}, {item,2,3292,33028,0,0,0,0,2,0,-1,0,4,0,3,1336301042,-1,[],1,9,[],[],[],0, []}]},
        {135928,<<"4399_4">>, [{item,2,1,10584,2,3,1,0,2,42,4,2,1,0,1,1335720096,925, [{22,100,87}, {20,100,406}, {19,100,325}, {17,100,30}, {5,101,0}, {6,101,0}, {7,101,0}, {29,9040,99}, {22,4040,10}, {18,6040,60}], 40,2,[], [{22,100,104},{19,100,372},{20,100,463}], [],0,[]}, {item,2,5866,30179,20,1,0,0,2,0,-1,0,1,0,30,1334470249,-1,[],50,2,[],[],[],0, []}]},
        {107566,<<"4399_4">>,  [{item,2,8499,22220,43,0,0,0,4,0,-1,0,2,0,42,1336558933,-1,[],1,9,[],[],[],0, []}, {item,2,8467,30121,20,1,0,0,3,0,-1,0,1,0,10,1336554018,-1,[],60,5,[],[],[],0, []}]},
        {137442, <<"4399_4">>, [{item,2,11,10724,13,3,1,0,2,0,4,0,1,0,11,1336371843,649, [{24,100,17}, {18,100,102}, {5,0,0}, {6,0,0}, {7,0,0}, {24,6035,6}, {22,5035,5}], 45,9,[],[],[],0,[]}]},
        {108268, <<"4399_4">>,[{item,2,2,10914,11,3,1,0,2,0,5,2,1,0,2,1334801106,1525, [{15,100,961}, {21,100,296}, {5,101,0}, {6,0,0}, {7,0,0}, {16,3050,122}, {21,9050,149}], 50,1,[],[],[],0,[]}, {item,2,5,10624,6,3,1,0,2,0,4,2,1,0,5,1333666254,795, [{15,100,581}, {21,100,173}, {5,0,0}, {6,0,0}, {7,0,0}, {16,3040,77}, {25,7040,7}], 40,1,[],[],[],0,[]}, {item,2,6,10649,10,3,1,0,2,0,5,2,1,0,6,1333666229,365, [{15,100,720}, {21,100,214}, {5,0,0}, {6,0,0}, {7,0,0}, {16,5040,161}, {21,2040,24}, {21,1040,12}], 40,1,[],[],[],0,[]}, {item,2,9,10754,12,3,1,0,2,0,5,0,1,0,9,1334800843,635, [{16,100,721}, {15,100,667}, {5,0,0}, {6,0,0}, {7,0,0}, {31,3045,112}, {65,10045,16}, {33,2045,75}], 45,9,[],[],[],0,[]}, {item,2,1,10574,1,3,1,0,2,49,4,8,1,0,1,1332971500,1035, [{22,100,87}, {20,100,533}, {19,100,426}, {17,100,30}, {5,101,0}, {6,101,26004}, {7,101,0}, {29,6040,65}, {18,2040,22}, {18,5040,62}], 40,1,[], [{22,100,89},{19,100,434},{20,100,542}], [],0,[]}, {item,2,35974,33031,0,0,0,0,2,0,-1,0,1,0,12,1335581202,-1,[],1,9,[],[],[],0, []}, {item,2,35975,10574,1,3,1,0,2,1,4,3,1,0,13,1335983100,839, [{22,100,1}, {20,100,91}, {19,100,72}, {17,100,30}, {5,101,0}, {6,0,0}, {7,0,0}, {24,5040,11}, {18,5040,62}], 40,1,[], [{22,100,89},{19,100,434},{20,100,542}], [],0,[]}, {item,2,35979,25001,18,0,0,0,0,0,-1,0,5,0,17,1336077335,-1,[],1,9,[],[],[],0, []}, {item,2,35983,25003,18,0,0,0,2,0,-1,0,7,0,21,1336096449,-1,[],1,9,[],[],[],0, []}, {item,2,35984,25010,18,0,0,0,0,0,-1,0,40,0,22,1336077338,-1,[],1,9,[],[],[], 0,[]}, {item,2,35985,25010,18,0,0,0,0,0,-1,0,12,0,23,1336077268,-1,[],1,9,[],[],[], 0,[]}, {item,2,331,24030,39,0,0,0,0,0,-1,0,14,0,34,1335664059,-1,[],1,9,[],[],[],0, []}, {item,2,329,26026,28,0,0,0,1,0,-1,0,1,0,32,1334180628,-1, [{23,100,8}], 1,9,[],[],[],0,[]}, {item,2,315,30140,20,1,0,0,2,0,-1,0,1,0,18,1335387415,-1,[],55,1,[],[],[],0, []}, {item,2,305,25030,18,0,0,0,3,0,-1,0,1,0,8,1334508504,-1,[],1,9,[],[],[],0, []}]}
    ];
data(5) ->
    [
        {62398, <<"4399_5">>, [{item,2,6033,26007,28,0,0,0,1,0,-1,0,1,0,43,1336647591,-1, [{25,100,10}], 1,9,[],[],[],0,[]}, {item,2,6032,33028,0,0,0,0,2,0,-1,0,6,0,42,1336647601,-1,[],1,9,[],[],[],0, []}, {item,2,6031,10728,11,3,0,0,1,0,0,0,1,0,41,1336647576,1280, [{21,100,131},{15,100,440},{5,0,0},{6,0,0},{7,0,0}], 40,1,[],[],[],0,[]}]},
        {41529,<<"4399_5">>, [{item,2,16,25033,18,0,0,0,3,0,-1,0,1,0,6,1334157206,-1,[],1,9,[],[],[],0,[]}]},
        {217, <<"4399_5">>, [{item,2,463436,25039,18,0,0,0,3,0,-1,0,1,0,14,1336659538,-1,[],1,9,[],[],[], 0,[]}]}
    ].
